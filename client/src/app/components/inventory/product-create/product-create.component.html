<ng-container *ngIf="createProductForm">

    <!-- Image Uploader -->
    <ng-template #fileUploader>
        <input type="file" #fileInput multiple accept="image/*" (change)="onChangeFileInput()" />
        <button mat-fab class="upload" color="accent" (click)="onClickFileInputButton()">
            <mat-icon>cloud_upload</mat-icon>
        </button>
    </ng-template>

    <!-- Images -->
    <ng-container *ngIf="!mainImage">
        <mat-card class="product-images">
            <ng-template [ngTemplateOutlet]="fileUploader"></ng-template>
        </mat-card>
    </ng-container>
    <ng-container *ngIf="mainImage">
        <app-preview [customOptions]="customOptions" [previews]="previews"></app-preview>
        <br>
        <ng-template [ngTemplateOutlet]="fileUploader"></ng-template>
        <br><br>
    </ng-container>

    <!-- Create Product form -->
    <form #formDir="ngForm" [formGroup]="createProductForm" (ngSubmit)="onSubmit()" class="form">
        <mat-card class="contact-card entity">
            <mat-card-header>
                <mat-card-title>New Product <br><br></mat-card-title>
            </mat-card-header>
            <mat-card-content>

                <!-- Name -->
                <mat-form-field class="flexible-input">
                    <mat-label>Name</mat-label>
                    <input type="text" matInput formControlName="name">
                </mat-form-field>

                <!-- Description -->
                <mat-form-field class="flexible-input">
                    <mat-label>Description</mat-label>
                    <textarea rows="5" type="text" matInput formControlName="description"></textarea>
                </mat-form-field>

                <!-- Specifications -->
                <button mat-fab extended type="button" color="primary" (click)="addSpecification()">
                    <mat-icon>add</mat-icon>
                    Add Specification Categories
                </button><br><br>
                <div formArrayName="specifications">
                    <mat-accordion>
                        <ng-container *ngFor="let spec of unique_specs">
                            <mat-expansion-panel class="spec-expansion" [expanded]="spec.isOpen">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        {{ spec.name }}

                                    </mat-panel-title>
                                    <span class="spec-actions">
                                        <button mat-mini-fab class="spec-actions" type="button" color="primary" (click)="pushNewSpecForm(spec, $event)">
                                            <mat-icon>add</mat-icon>
                                        </button>
                                    </span>
                                    <span class="spec-desc">{{ spec.count }}</span>

                                </mat-expansion-panel-header>
                                <!-- Spec form for unique Category -->
                                <ng-container *ngFor="let specControl of specs.controls; let i=index;">
                                    <div [formGroupName]="i" *ngIf="specControl.get('category')?.value === spec.name">

                                        <!-- Category -->
                                        <mat-form-field style="display: none;">
                                            <mat-label>Category</mat-label>
                                            <input type="text" matInput formControlName="category">
                                        </mat-form-field>

                                        <!-- Name -->
                                        <mat-form-field class="key-value-input">
                                            <mat-label>Name</mat-label>
                                            <input type="text" matInput formControlName="name">
                                        </mat-form-field>

                                        <!-- Value -->
                                        <mat-form-field class="key-value-input">
                                            <mat-label>Value</mat-label>
                                            <input type="text" matInput formControlName="value">
                                        </mat-form-field>

                                    </div>
                                </ng-container>
                                <!-- Add Specs in current Category -->
                                <button mat-mini-fab type="button" color="primary" (click)="pushNewSpecForm(spec)">
                                    <mat-icon>add</mat-icon>
                                </button>

                            </mat-expansion-panel>
                            <br>
                        </ng-container>
                    </mat-accordion>
                </div>
                <button mat-mini-fab type="button" color="primary" *ngIf="specs.controls.length > 1"
                    (click)="addSpecification()">
                    <mat-icon>add</mat-icon>
                </button>

            </mat-card-content>

            <mat-card-actions align="end">
                <button mat-raised-button type="submit" color="primary" type="submit">Save</button>
                <button mat-raised-button type="button" routerLink="/inventory">Cancel</button>
            </mat-card-actions>
        </mat-card>
    </form>
</ng-container>